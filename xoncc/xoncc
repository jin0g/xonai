#!/bin/sh
# xoncc - Launch xonsh with xoncc extension loaded

# Check if xonsh is installed
if ! command -v xonsh >/dev/null 2>&1; then
    echo "Error: xonsh is not installed." >&2
    echo "Please install xonsh first: pip install xonsh" >&2
    exit 1
fi

# Create temporary xonshrc file
TEMP_RC=$(mktemp -t xoncc.XXXXXX.xsh)
trap "rm -f $TEMP_RC" EXIT

# Load user's existing xonshrc if it exists
if [ -f "$HOME/.xonshrc" ]; then
    echo "source $HOME/.xonshrc" >> "$TEMP_RC"
    echo "" >> "$TEMP_RC"
fi

# Add xoncc loading
cat >> "$TEMP_RC" << 'EOF'
# Load xoncc xontrib
try:
    xontrib load xoncc
except Exception as e:
    print(f'Warning: Failed to load xoncc: {e}')
EOF

# Launch xonsh with custom rc file
XONSHRC="$TEMP_RC" exec xonsh "$@"